---
interface Props {
  title: string;
  description: string;
  ogImage?: string;
  ogType?: string;
  twitterCard?: string;
  keywords?: string[];
  author?: string;
  canonical?: string;
}

const { 
  title, 
  description, 
  ogImage = '/logo.svg',
  ogType = 'website',
  twitterCard = 'summary_large_image',
  keywords = [],
  author = 'Антон Двинянинов',
  canonical
} = Astro.props;

const currentUrl = canonical || Astro.url.href;
---

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>{title}</title>
    <meta name="description" content={description}>
    {keywords.length > 0 && <meta name="keywords" content={keywords.join(', ')}>}
    <meta name="author" content={author}>
    <link rel="canonical" href={currentUrl}>
    
    <!-- AI Meta Tags -->
    <meta name="ai:summary" content={description}>
    <meta name="ai:category" content="Web Development, UI/UX Design, Full-stack Development">
    <meta name="ai:contact" content="anton@dvinyaninov.ru">
    
    <!-- Open Graph -->
    <meta property="og:type" content={ogType}>
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:url" content={currentUrl}>
    <meta property="og:image" content={ogImage}>
    <meta property="og:site_name" content="Антон Двинянинов — Full-stack разработчик">
    <meta property="og:locale" content="ru_RU">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content={twitterCard}>
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content={description}>
    <meta name="twitter:image" content={ogImage}>
    
    <!-- Schema.org -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Антон Двинянинов",
      "jobTitle": "Full-stack разработчик и UI/UX дизайнер",
      "url": "https://dvinyaninov.ru",
      "email": "anton@dvinyaninov.ru",
      "image": "https://dvinyaninov.ru/logo.svg",
      "sameAs": [
        "https://t.me/dvinyaninov",
        "https://vk.com/dvinyaninov",
        "https://dzen.ru/dvinyaninov",
        "https://youtube.com/@dvinyaninov"
      ],
      "knowsAbout": [
        "Web Development",
        "UI/UX Design",
        "Frontend Development",
        "Backend Development",
        "DevOps",
        "JavaScript",
        "TypeScript",
        "React",
        "Vue.js",
        "Node.js",
        "Laravel",
        "Go",
        "Tilda"
      ],
      "alumniOf": {
        "@type": "Organization",
        "name": "Веб-разработка"
      },
      "worksFor": {
        "@type": "Organization",
        "name": "Фриланс"
      }
    })} />
    
    <!-- WebPage Schema -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": title,
      "description": description,
      "url": currentUrl,
      "author": {
        "@type": "Person",
        "name": author
      }
    })} />
    
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta name="theme-color" content="#0D4CD3">
    
    <!-- DNS prefetch и preconnect для внешних ресурсов -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload критичных шрифтов для ускорения FCP/LCP -->
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@600;700&display=swap" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@600;7 00&display=swap"></noscript>
    
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    
    <link rel="dns-prefetch" href="https://code.jivosite.com">
    <link rel="preconnect" href="https://code.jivosite.com" crossorigin>
    
    <link rel="dns-prefetch" href="https://mc.yandex.ru">
    <link rel="preconnect" href="https://mc.yandex.ru" crossorigin>
    
    <link rel="dns-prefetch" href="https://privacy-cs.mail.ru">
    <link rel="preconnect" href="https://privacy-cs.mail.ru" crossorigin>
    
    <link rel="dns-prefetch" href="https://top-fwz1.mail.ru">
    <link rel="preconnect" href="https://top-fwz1.mail.ru" crossorigin>
    
    <!-- Preload критичных ресурсов -->
    <link rel="preload" href="/images/projects/zooplatforma.webp" as="image" type="image/webp">
    
    <!-- Inline критичные шрифты для мгновенной загрузки -->
    <style>
        /* Space Grotesk 600 и 700 - самые используемые веса */
        /* Минимальный inline CSS для критичного рендеринга */
        @font-face {
            font-family: 'Space Grotesk';
            font-style: normal;
            font-weight: 600;
            font-display: swap;
            src: local('Space Grotesk SemiBold'), local('SpaceGrotesk-SemiBold');
        }
        @font-face {
            font-family: 'Space Grotesk';
            font-style: normal;
            font-weight: 700;
            font-display: swap;
            src: local('Space Grotesk Bold'), local('SpaceGrotesk-Bold');
        }
    </style>
    
    <!-- Остальные шрифты загружаем асинхронно -->
    <link rel="preload" href="/fonts/fonts.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/fonts/fonts.css"></noscript>
    
    <!-- Загружаем CSS синхронно для стабильности -->
    <link rel="stylesheet" href="/styles/global.css">
    
    <!-- Named slot для дополнительных стилей -->
    <slot name="head" />
    
    <!-- Google Tag Manager - отложенная загрузка -->
    <script is:inline>
    // Загружаем GTM после взаимодействия пользователя или с задержкой
    function loadGTM() {
        if (window.gtmLoaded) return;
        window.gtmLoaded = true;
        
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-NTP4Z73');
    }
    
    // Определяем мобильное устройство
    var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    // Загружаем при первом взаимодействии
    ['mousedown', 'touchstart', 'keydown', 'scroll'].forEach(function(event) {
        window.addEventListener(event, loadGTM, { once: true, passive: true });
    });
    
    // Для мобильных - через 5 секунд, для десктопа - через 3 секунды
    setTimeout(loadGTM, isMobile ? 5000 : 3000);
    </script>
    <!-- End Google Tag Manager -->
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NTP4Z73"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="noise"></div>
    
    <slot />
    
    <footer class="footer">
        <div class="footer__left">
            <span>© 2026</span>
            <span class="footer__divider">/</span>
            <span>Антон Двинянинов</span>
        </div>
        <div class="footer__right">
            <span>Сделано с</span>
            <span class="footer__heart">♥</span>
            <span>и кодом</span>
        </div>
    </footer>

    <!-- Defer скриптов для ускорения загрузки -->
    <script src="/scripts/main.js" is:inline defer></script>
    <script src="/scripts/telegram-forms.js" is:inline defer></script>
</body>
</html>
