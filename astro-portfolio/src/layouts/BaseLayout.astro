---
interface Props {
  title: string;
  description: string;
  ogImage?: string;
  ogType?: string;
  twitterCard?: string;
  keywords?: string[];
  author?: string;
  canonical?: string;
}

const { 
  title, 
  description, 
  ogImage = '/logo.svg',
  ogType = 'website',
  twitterCard = 'summary_large_image',
  keywords = [],
  author = 'Антон Двинянинов',
  canonical
} = Astro.props;

const currentUrl = canonical || Astro.url.href;
---

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>{title}</title>
    <meta name="description" content={description}>
    {keywords.length > 0 && <meta name="keywords" content={keywords.join(', ')}>}
    <meta name="author" content={author}>
    <link rel="canonical" href={currentUrl}>
    
    <!-- AI Meta Tags -->
    <meta name="ai:summary" content={description}>
    <meta name="ai:category" content="Web Development, UI/UX Design, Full-stack Development">
    <meta name="ai:contact" content="anton@dvinyaninov.ru">
    
    <!-- Open Graph -->
    <meta property="og:type" content={ogType}>
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:url" content={currentUrl}>
    <meta property="og:image" content={ogImage}>
    <meta property="og:site_name" content="Антон Двинянинов — Full-stack разработчик">
    <meta property="og:locale" content="ru_RU">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content={twitterCard}>
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content={description}>
    <meta name="twitter:image" content={ogImage}>
    
    <!-- Schema.org -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Антон Двинянинов",
      "jobTitle": "Full-stack разработчик и UI/UX дизайнер",
      "url": "https://dvinyaninov.ru",
      "email": "anton@dvinyaninov.ru",
      "image": "https://dvinyaninov.ru/logo.svg",
      "sameAs": [
        "https://t.me/dvinyaninov",
        "https://vk.com/dvinyaninov",
        "https://dzen.ru/dvinyaninov",
        "https://youtube.com/@dvinyaninov"
      ],
      "knowsAbout": [
        "Web Development",
        "UI/UX Design",
        "Frontend Development",
        "Backend Development",
        "DevOps",
        "JavaScript",
        "TypeScript",
        "React",
        "Vue.js",
        "Node.js",
        "Laravel",
        "Go",
        "Tilda"
      ],
      "alumniOf": {
        "@type": "Organization",
        "name": "Веб-разработка"
      },
      "worksFor": {
        "@type": "Organization",
        "name": "Фриланс"
      }
    })} />
    
    <!-- WebPage Schema -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": title,
      "description": description,
      "url": currentUrl,
      "author": {
        "@type": "Person",
        "name": author
      }
    })} />
    
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta name="theme-color" content="#0D4CD3">
    
    <!-- DNS prefetch и preconnect для критичных ресурсов -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload критичных шрифтов для ускорения FCP/LCP -->
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@600;700&display=swap" fetchpriority="high">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@600;700&display=swap" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@600;700&display=swap"></noscript>
    
    <!-- DNS prefetch для некритичных внешних ресурсов (без preconnect для экономии) -->
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://code.jivosite.com">
    <link rel="dns-prefetch" href="https://mc.yandex.ru">
    <link rel="dns-prefetch" href="https://privacy-cs.mail.ru">
    <link rel="dns-prefetch" href="https://top-fwz1.mail.ru">
    
    <!-- Inline критичный CSS для мгновенного рендеринга -->
    <style>
        /* Критичные CSS переменные и базовые стили */
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#fff;--text:#1F2229;--text-secondary:#5D6066;--accent:#0D4CD3;--accent-hover:#0A3BA8;
            --border:#E5E7EB;--card-bg:#F9FAFB;--bg-secondary:#F9FAFB;
            --font-size-xs:12px;--font-size-sm:14px;--font-size-base:16px;--font-size-lg:18px;
            --font-size-xl:20px;--font-size-2xl:24px;--font-size-3xl:32px;--font-size-4xl:40px;--font-size-5xl:48px;
            --spacing-xs:4px;--spacing-sm:8px;--spacing-md:16px;--spacing-lg:24px;--spacing-xl:32px;
            --spacing-2xl:40px;--spacing-3xl:48px;--spacing-4xl:64px;
            --radius-sm:4px;--radius-md:8px;--radius-lg:12px;--radius-xl:16px;
        }
        body{
            font-family:'Space Grotesk',sans-serif;
            background:var(--bg);
            color:var(--text);
            overflow-x:hidden;
            font-size:var(--font-size-base);
            line-height:1.5;
        }
        .noise{
            position:fixed;top:0;left:0;width:100%;height:100%;opacity:0.03;z-index:-1;
            background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' /%3E%3C/svg%3E");
        }
        /* Критичные layout стили для предотвращения CLS */
        main{display:block;min-height:100vh}
        .project-main{
            max-width:1400px;
            margin:0 auto;
            padding:40px 60px;
        }
        .breadcrumbs{
            margin:0 0 32px 0;
            padding:0;
            font-size:14px;
            color:var(--text-secondary);
        }
        .breadcrumbs__list{
            display:flex;
            align-items:center;
            gap:8px;
            list-style:none;
            margin:0;
            padding:0;
        }
        .breadcrumbs__item{display:inline}
        .project-hero{
            margin:0 0 80px 0;
            padding:0;
        }
        .project-hero__content{
            max-width:800px;
        }
        .project-hero__title-wrapper{
            display:flex;
            align-items:center;
            gap:16px;
            margin-bottom:16px;
        }
        .project-hero__logo{
            max-width:80px;
            max-height:80px;
            width:auto;
            height:auto;
        }
        .project-hero__label{
            display:inline-block;
            padding:8px 16px;
            font-size:12px;
            text-transform:uppercase;
            letter-spacing:0.05em;
            color:var(--accent);
            background:rgba(13,76,211,0.1);
            border-radius:4px;
            margin-bottom:16px;
        }
        .project-hero__title{
            font-size:clamp(48px,7vw,80px);
            font-weight:700;
            line-height:1.1;
            margin-bottom:24px;
        }
        .project-hero__desc{
            font-size:20px;
            line-height:1.6;
            color:var(--text-secondary);
            margin-bottom:32px;
        }
        .project-hero__sidebar{
            display:flex;
            flex-direction:column;
            gap:24px;
        }
        .back-link{
            display:inline-flex;
            align-items:center;
            gap:8px;
            color:var(--text-secondary);
            text-decoration:none;
            font-size:14px;
            margin-bottom:32px;
        }
        /* Мобильные стили для предотвращения CLS */
        @media (max-width:768px){
            .project-main{padding:20px}
            .breadcrumbs{margin:0 0 15px 0;font-size:12px}
            .project-hero{margin-bottom:60px}
            .project-hero__title{font-size:clamp(28px,7vw,56px);margin-bottom:16px}
            .project-hero__desc{font-size:15px;margin-bottom:24px}
            .project-hero__logo{display:none}
            .project-hero__title-wrapper{gap:8px}
        }
        /* Space Grotesk 600 и 700 - самые используемые веса */
        @font-face {
            font-family: 'Space Grotesk';
            font-style: normal;
            font-weight: 600;
            font-display: swap;
            src: local('Space Grotesk SemiBold'), local('SpaceGrotesk-SemiBold');
        }
        @font-face {
            font-family: 'Space Grotesk';
            font-style: normal;
            font-weight: 700;
            font-display: swap;
            src: local('Space Grotesk Bold'), local('SpaceGrotesk-Bold');
        }
    </style>
    
    <!-- Остальные шрифты загружаем асинхронно -->
    <link rel="preload" href="/fonts/fonts.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/fonts/fonts.css"></noscript>
    
    <!-- Загружаем CSS синхронно для предотвращения CLS -->
    <link rel="stylesheet" href="/styles/global.css">
    
    <!-- Named slot для дополнительных стилей -->
    <slot name="head" />
    
    <!-- Google Tag Manager - отложенная загрузка -->
    <script is:inline>
    // Загружаем GTM после взаимодействия пользователя или с задержкой
    function loadGTM() {
        if (window.gtmLoaded) return;
        window.gtmLoaded = true;
        
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-NTP4Z73');
    }
    
    // Определяем мобильное устройство
    var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    // Загружаем при первом взаимодействии
    ['mousedown', 'touchstart', 'keydown', 'scroll'].forEach(function(event) {
        window.addEventListener(event, loadGTM, { once: true, passive: true });
    });
    
    // Для мобильных - через 5 секунд, для десктопа - через 3 секунды
    setTimeout(loadGTM, isMobile ? 5000 : 3000);
    </script>
    <!-- End Google Tag Manager -->
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NTP4Z73"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="noise"></div>
    
    <slot />
    
    <footer class="footer">
        <div class="footer__left">
            <span>© 2026</span>
            <span class="footer__divider">/</span>
            <span>Антон Двинянинов</span>
        </div>
        <div class="footer__right">
            <span>Сделано с</span>
            <span class="footer__heart">♥</span>
            <span>и кодом</span>
        </div>
    </footer>

    <!-- Defer скриптов для ускорения загрузки -->
    <script src="/scripts/main.js" is:inline defer></script>
    <script src="/scripts/telegram-forms.js" is:inline defer></script>
</body>
</html>
